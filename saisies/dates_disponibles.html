#SET{valeur,''}
[(#ENV*{valeur}|oui)
	#SET{valeur,#ENV{valeur}}
]

[(#ENV{multiple}|oui)
	[(#SET{valeur,[(#ENV*{valeur}|is_array|?{[(#ENV*{valeur})],[(#ENV*{valeur}|explode{','})]})]})]
]
#SET{date_actuelle,#ENV{date}}

#SET{_date_actuelle,#GET{date_actuelle}}
#SET{date_defaut,#ENV{valeur_forcee,#ENV{valeur,#ENV{defaut,#GET{_date_actuelle}}}}}
[(#ENV{horaire}|non)
	#SET{date_defaut,#GET{date_defaut}|affdate{Y-m-d}}
	[(#GET{valeur}|oui)
		#SET{valeur,#GET{valeur}|affdate{Y-m-d}}
	]
]

[(#ENV{multiple}|oui)
	#SET{_date_actuelle,#ARRAY{#GET{date_actuelle}}
]

#SET{date_debut,#ENV{date_debut,#GET{date_actuelle}}}
#SET{date_limite,#ENV{date_limite,#GET{date_actuelle}|date_relative_brut{+1 year}}}

#SET{dates_disponibles,#INCLURE{fond=inclure/dates_disponibles_tableau,
	env,
	disponible='',
	date_debut=#GET{date_debut},
	date_limite=#GET{date_limite}}|unserialize}

#SET{dates_disponibles,#INCLURE{fond=inclure/dates_disponibles_tableau,
	env,
	disponible=1,
	date_debut=#GET{date_debut},
	date_limite=#GET{date_limite}}|unserialize}


[(#GET{valeur}|oui)
	#SET{dates_disponibles,#GET{dates_disponibles}|push{#GET{valeur}}
]

<select name="#ENV{nom}[(#ENV{multiple}|?{\[\]})]" id="champ_[(#ENV{nom}|saisie_nom2classe)]"[ class="(#ENV{class})"][(#ENV{multiple}|oui) multiple="multiple" size="#ENV{size,10}"][ disabled="(#ENV{disable})"]>
	[(#ENV{cacher_option_intro}|ou{#ENV{multiple}}|non)
	<option value="">[(#ENV{option_intro})]</option>]
	<BOUCLE_dates(DATA) {source tableau, #GET{dates_disponibles}|array_unique} {par valeur} >
		#SET{date,#VALEUR}
		[(#ENV{multiple}|oui)
		<option value="#GET{date}"[(#GET{date}|in_array{#GET{date_defaut}}|oui) selected="selected"]>
			[(#VALEUR|affdate_court)]
		</option>]
	[(#ENV{multiple}|non)
		<option value="#GET{date}"[(#GET{date}|=={#GET{date_defaut}}|oui) selected="selected"]>
		[(#VALEUR|affdate_court)]
		</option>]
	</BOUCLE_dates>
</select>
